@* @{
    ViewData["Title"] = "Home Page";
}
<h2>@ViewBag.Message</h2>


<div class="text-center">
    <h1 class="display-4">Welcome</h1>
    <p>Learn about <a href="https://docs.microsoft.com/aspnet/core">building Web apps with ASP.NET Core</a>.</p>
</div>
 *@

@{
    ViewData["Title"] = "Home Page";
    var currentUser = ViewBag.CurrentUser as string;
    var allUsers = ViewBag.AllUsers as List<Microsoft.AspNetCore.Identity.IdentityUser>;
}
@if (!string.IsNullOrEmpty(currentUser))
{
    <div class="text-center">
        <h1 class="display-4">Send a Message</h1>
    </div>

    <form asp-controller="Home" asp-action="Send" method="post">
        <div class="form-group">
            <label>Sender</label>
            <input type="text" class="form-control" value="@currentUser" readonly />
        </div>

        <div class="form-group">
            <label>Receiver</label>
            <select class="form-control" name="Receiver">
                <option value="">-- Select Receiver --</option>
                @foreach (var user in allUsers)
                {
                    // Exclude logged-in user from dropdown
                    if (user.UserName != currentUser)
                    {
                        <option value="@user.UserName">@user.UserName (@user.Email)</option>
                    }
                }
            </select>
        </div>

        <div class="form-group">
            <label>Message</label>
            <textarea class="form-control" name="Message" rows="3"></textarea>
        </div>
        <input type="hidden" id="Latitude" name="Latitude" />
        <input type="hidden" id="Longitude" name="Longitude" />



        <button type="submit" class="btn btn-primary mt-2">Send Message</button>
    </form>
    //
    //
    //
    //
    //
    <div class="text-center">
        <h1 class="display-4">View Chat</h1>
    </div>

    <form asp-controller="Home" asp-action="Chat" method="post">

        <div class="form-group">
            <label>Receiver</label>
            <select class="form-control" name="withUser">
                <option value="">-- Select Receiver --</option>
                @foreach (var user in allUsers)
                {
                    // Exclude logged-in user from dropdown
                    if (user.UserName != currentUser)
                    {
                        <option value="@user.UserName">@user.UserName (@user.Email)</option>
                    }
                }
            </select>
        </div>
        <button type="submit" class="btn btn-primary mt-2">View Message</button>
    </form>
    //
    //
    <script>
        window.onload = function () {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        document.getElementById("Latitude").value = position.coords.latitude;
                        document.getElementById("Longitude").value = position.coords.longitude;
                    },
                    (error) => {
                        console.error("Location error:", error.message);
                    }
                );
            }
        }
    </script>

    

}